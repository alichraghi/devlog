<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Mach v0.1 - cross-platform Zig graphics in ~60 seconds</title>
  <meta name="description" content="Five months ago we announced some of our vision for Mach &amp;amp; the future of graphics with Zig. Today we’ve reached Mach v0.1 with over 1,100 commits.">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/2022/mach-v0.1-zig-graphics-in-60s">
  
  
  <link rel="alternate" type="application/rss+xml" title="Hexops&#39; devlog" href="/feed.xml">

  

  
  <meta property="og:title" content="Mach v0.1 - cross-platform Zig graphics in ~60 seconds">
  <meta property="og:site_name" content="Hexops&#39; devlog">
  <meta property="og:url" content="/2022/mach-v0.1-zig-graphics-in-60s">
  <meta property="og:description" content="Five months ago we announced some of our vision for Mach &amp;amp; the future of graphics with Zig. Today we’ve reached Mach v0.1 with over 1,100 commits.">
  
  
    <meta property="og:image" content="https://user-images.githubusercontent.com/3173176/160258304-3335a609-6177-4c1a-9008-d9525bd72c85.png">
  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Mach v0.1 - cross-platform Zig graphics in ~60 seconds">
  <meta name="twitter:description" content="Five months ago we announced some of our vision for Mach &amp;amp; the future of graphics with Zig. Today we’ve reached Mach v0.1 with over 1,100 commits.">
  
  
    <meta name="twitter:image:src" content="https://raw.githubusercontent.com/hexops/website/master/media/png/square_logo.png">
  

  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bitter:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">

  

</head>


  <body>

    <header class="site-header">

    <div class="wrapper">

      <a class="site-title" href="/">
        <img alt="Hexops" class="logo color" src="https://raw.githubusercontent.com/hexops/media/main/logo.svg" style="height: 30px;">' devlog
      </a>
      <link href="/assets/font/stylesheet.css?v2" rel="stylesheet">
      <link rel="icon" sizes="any" type="image/svg+xml" href="https://raw.githubusercontent.com/hexops/website/master/media/svg/icon.svg">

      <script async defer data-domain="devlog.hexops.com" src="https://devlog.hexops.com/assets/opendata.js"></script>

      <nav class="site-nav">
        
          
          <a class="page-link" href="/about">About</a>
        
          
          <a class="page-link" href="/archives">Archives</a>
        
          
          <a class="page-link" href="https://github.com/hexops">GitHub</a>
        
      </nav>
  
    </div>
  
  </header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Mach v0.1 - cross-platform Zig graphics in ~60 seconds</h1>
    
    <p class="post-meta"><time datetime="2022-03-26T00:00:00+00:00" itemprop="datePublished">Mar 26, 2022</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Stephen Gutekanst</span></span> •
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/mach/">mach,</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/gamedev/">gamedev</a>
      
    
  



</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Five months ago we announced some of our vision for Mach &amp; <a href="https://devlog.hexops.com/2021/mach-engine-the-future-of-graphics-with-zig">the future of graphics with Zig</a>. Today we’ve reached Mach v0.1 with over 1,100 commits.</p>

<h2 id="cross-platform-graphics-in-60-seconds">Cross-platform graphics in 60 seconds</h2>

<p>If you have <a href="https://ziglang.org/">Zig v0.10</a> you can get started with cross-platform graphics in under 60 seconds, try it for yourself:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/hexops/mach
<span class="nb">cd </span>mach/gpu
zig build run-example
</code></pre></div></div>

<p>(not working? see <a href="https://github.com/hexops/mach/blob/main/doc/known-issues.md#known-issues">known issues</a>)</p>

<p><img class="color img-center" src="https://user-images.githubusercontent.com/3173176/159139851-013fc1ad-98d2-4fed-ae58-1d5eaa658a15.png" /></p>

<h2 id="all-you-need-is-zig-git-and-curl">All you need is zig, git, and curl.</h2>

<p>One key point we’re solving with Mach is the developer experience. We’re tired of people wasting hours and sometimes days getting the right versions of dependencies on their system in order to build projects!</p>

<p><img class="color img-center" src="https://user-images.githubusercontent.com/3173176/159140683-0714eb12-806a-43e5-980f-63aa0d998fc2.png" /></p>

<p>Our <a href="https://github.com/hexops/mach-glfw">glfw bindings</a> build GLFW 100% from source using Zig. We even go so far as to build the DirectX Shader Compiler from source via Zig’s build system.</p>

<p>For the few inescapable system dependencies, such as <code class="language-plaintext highlighter-rouge">Metal.framework</code> or <code class="language-plaintext highlighter-rouge">libx11</code>, we <a href="https://github.com/hexops/mach-system-sdk">package them up ourselves</a> and our build system knows how to fetch them as needed.</p>

<h2 id="effortless-cross-compilation">Effortless cross-compilation</h2>

<p>Because of our aggressive approach to solving dependencies, you get effortless cross-compilation to any OS literally at the flip of a switch:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zig build -Dtarget=x86_64-windows
$ zig build -Dtarget=x86_64-linux
$ zig build -Dtarget=x86_64-macos.12
$ zig build -Dtarget=aarch64-macos.12
</code></pre></div></div>

<p>The binaries you end up with are virtually static.</p>

<p>For Linux, Zig lets you target any glibc version, and musl too, so no more worrying if that binary will run on other machines.</p>

<h3 id="unified-graphics-api-metal-vulkan-directx-12">Unified graphics API (Metal, Vulkan, DirectX 12)</h3>

<p>Backed by Metal, Vulkan, DirectX 12 &amp; OpenGL (as a fallback), you get a truly cross-platform graphics API for Windows, Linux, and macOS (Browser and Mobile coming in the future)</p>

<p><img class="color img-of-code" src="https://user-images.githubusercontent.com/3173176/160258676-3031e453-c43b-4a9a-b1f7-bfa31c1e002f.png" /></p>

<h3 id="unified-shader-language--compute-shaders">Unified shader language &amp; compute shaders</h3>

<p>There’s no need to write shaders for each graphics backend, instead you write shaders in a single modern language (WGSL):</p>

<p><img class="color img-of-code" src="https://user-images.githubusercontent.com/3173176/160258785-ffeffec7-c7ce-4e1f-a133-1ff849c91f80.png" /></p>

<p>With compute shaders, you have the ability to leverage computation on the GPU outside of graphical applications (machine learning, physics calculations, etc.) using a straightforward &amp; approachable API that works with every GPU vendor.</p>

<h3 id="behind-the-scenes">Behind the scenes</h3>

<p><img class="color" style="max-height: 175px; display: block; margin: auto;" src="https://user-images.githubusercontent.com/3173176/160266635-e35438bc-da23-4b2b-8be0-05ae4cce01c0.png" /></p>

<p>Mach <a href="https://gpuweb.github.io/gpuweb/explainer/">leverages WebGPU</a>, a successor to WebGL. WebGPU is an up and coming graphics API being built by Mozilla, Google, Apple, Microsoft, Intel and others.</p>

<p>Natively, Mach uses Zig as a C/C++ compiler to build <a href="https://github.com/hexops/mach-gpu-dawn">Google Chrome’s native WebGPU implementation</a> and we use Zig’s build system so you don’t even have to deal with cmake/ninja/gn/etc.</p>

<p>Our infrastructure produces binary releases so you don’t even have to wait the handful of minutes it would take to compile by default. From-source builds are literally at your fingertips, though, just add <code class="language-plaintext highlighter-rouge">-Ddawn-from-source=true</code> to your <code class="language-plaintext highlighter-rouge">zig build</code> command.</p>

<h2 id="machgpu-the-gpu-interface-for-zig"><code class="language-plaintext highlighter-rouge">mach/gpu</code>: the GPU interface for Zig</h2>

<p><a href="https://github.com/hexops/mach/tree/main/gpu">mach/gpu</a> is our Zig interface to WebGPU and comes in at just over 250 commits.</p>

<p><img class="img-center" style="max-height: 125px;" src="https://user-images.githubusercontent.com/3173176/160261203-505aa417-e990-45bb-8a3d-17e224f1506c.png" /></p>

<p>It provides a <code class="language-plaintext highlighter-rouge">gpu.Interface</code>, similar to how Zig provides a <code class="language-plaintext highlighter-rouge">std.mem.Allocator</code> interface, it’s backed by any implementation:</p>

<ul>
  <li>A <code class="language-plaintext highlighter-rouge">NativeInstance</code> like Dawn (Google Chrome’s WebGPU implementation.)</li>
  <li>(future) A browser implementation when targeting WebAssembly.</li>
</ul>

<p>Imagine future implementations: maybe a pure-Zig implementation? Maybe a debugger implementation that <em>wraps an existing one</em> and streams all API calls to disk so you can replay them later and step through graphics API calls. Lots of possibilities here!</p>

<p>It’s a comprehensive interface, covering the 176 methods, 73 data structures, and 43 enum types that WebGPU exposes today - but there’s still much to do around documentation, fixing bugs, and ensuring we match the browser API nicely. but the foundation is all there!</p>

<h2 id="zig--greatness">Zig ≈ greatness</h2>

<p>Zig provides <a href="https://ziglang.org/learn/overview/#performance-and-safety-choose-two">some excellent runtime safety</a> and catches many of the mistakes people make in C/C++ (memory leaks, integer overflow, index out of bounds, etc.)</p>

<p>In fact, we’ve caught several instances of undefined behavior in GLFW, and even <a href="https://github.com/microsoft/DirectXShaderCompiler/pull/4178#discussion_r780733405">illegal integer coercion in the DirectX Shader Compiler</a> - all just by compiling C/C++ code using Zig.</p>

<p><a href="https://devlog.hexops.com/2021/perfecting-glfw-for-zig-and-finding-undefined-behavior"><img class="color img-center" style="max-height: 125px;" src="https://user-images.githubusercontent.com/3173176/160260551-41af24c6-9b35-44e9-a759-5966f47b5390.png" /></a></p>

<p>The reason we’re <em>really</em> ecstatic about Zig, though, are what it promises us in the future:</p>

<ul>
  <li><a href="https://twitter.com/andy_kelley/status/1483677253682675713">Blazing fast compilation</a>, compiling and running a program faster than Python can interpret it - impressive!</li>
  <li><a href="http://www.jakubkonka.com/2022/03/16/hcs-zig.html">Hot code swapping</a>, how cool would it be to edit variables etc. as your game is running?</li>
</ul>

<h2 id="entity-component-system">Entity Component System</h2>

<p>We’re building an Entity Component System <a href="https://devlog.hexops.com/categories/build-an-ecs/">in a blog series</a> and inspired by:</p>

<ul>
  <li>Data Oriented Design</li>
  <li>Database design</li>
  <li>Advice from the authors of <a href="https://bevyengine.org">Bevy</a> (a very popular ECS)</li>
</ul>

<p>It’s still early stages, we’ve got some ways to go! But we’re <a href="https://github.com/hexops/mach/tree/main/ecs">on our third major revision</a> and beginning to face the interesting problems. Keep an eye out for updates on that blog series coming soon.</p>

<h2 id="sounds-great-whats-the-catch">Sounds great! What’s the catch?</h2>

<p>Mach (and Zig) are still very early stages! APIs are going to change and break. Mach is missing <em>a lot!</em></p>

<ul>
  <li>Documentation..</li>
  <li>Examples..</li>
  <li>Demos..</li>
  <li>Browser and Mobile support..</li>
  <li>..Literally everything else that makes a game engine</li>
</ul>

<p>If you’re looking for cross-platform graphics in Zig, Mach is for you! Otherwise, you’ll probably need to wait a bit.</p>

<h2 id="getting-started">Getting started</h2>

<p>Check out <a href="https://github.com/hexops/mach">the GitHub</a> and in particular <a href="https://github.com/hexops/mach/tree/main/gpu/examples">this example code</a>.</p>

<p>There’s a ton of material out there about WebGPU already, check out <a href="https://surma.dev/things/webgpu/">this excellent and comprehensive introductory article</a> and <a href="https://github.com/austinEng/webgpu-samples">these awesome samples</a>. It should be easy to map any of these to the Mach <code class="language-plaintext highlighter-rouge">gpu.Interface</code> since it’s the same API, just Ziggified!</p>

<p>Join our <a href="https://matrix.to/#/#hexops:matrix.org">Matrix chat room</a> to get help, discuss, etc.</p>

<h2 id="a-personal-note">A personal note</h2>

<p><img class="color" style="float: left; margin-right: 2rem;" src="https://user-images.githubusercontent.com/3173176/160262520-6768c665-7127-4242-b77a-fd2340ed88cf.png" /> No, it’s not Tom from myspace - it’s me, <a href="https://twitter.com/slimsag">@slimsag</a>! It’s cool that we reached this milestone, but let’s be honest: it’s still just a dumb red triangle!</p>

<p>It’s taken <em>9 brutal months to get here</em> - staring at broken CI pipelines, C++ compiler errors, <a href="https://twitter.com/slimsag/status/1507506138144681986">buying hardware</a> to test every OS+arch possible - and slugging through the depths of hell <a href="https://twitter.com/slimsag/status/1471986125296205825">where only a footnote from Raymond Chen himself will save you.</a> All to get to a point where it all <em>just works the way you and I expect it to.</em></p>

<p>Given the chance, I’d scream from a rooftop “f***ing finally! Now we build the cool part!” because I am so <em>ecstatic</em> to have gotten to this point!</p>

<p>There are few things in life that I am <em>more serious about</em> than this. I dedicate ~48 hours/week to my dayjob, and ~50h/week to Zig building Mach and running <a href="https://zigmonthly.org">zigmonthly.org</a>. After three years of aggressively pushing for progress in this exact way, I have <a href="https://devlog.hexops.com/2021/I-write-code-100-hours-a-week">no plans to slow down anytime soon</a>.</p>

<p>This is <em>literally</em> just the beginning. Buckle up!</p>

<h2 id="whats-next">What’s next?</h2>

<p><img class="color img-center" style="max-height: 250px;" src="https://user-images.githubusercontent.com/3173176/160262449-79adcd0a-dde7-46fe-8730-316419f25516.png" /></p>

<p>My lightning talk in which I’ll be making the case for Mach engine and conveying the vision for where we go from here will be presented at the first-ever European <a href="https://zig.news/kristoff/zig-milan-party-2022-final-info-schedule-1jc1">Zig meetup in Milan, Italy on Apr 9-10</a>.</p>

<p>If like me you are unable to attend in person, the short video will be available afterwards on the <a href="https://twitter.com/machengine">@machengine</a> Twitter!</p>

<h2 id="help-us-reach-mach-v10">Help us reach Mach v1.0</h2>

<p>Consider <a href="https://github.com/sponsors/slimsag">sponsoring me on GitHub</a> if you like my work, so I can do more of it!</p>

<p>Join our <a href="https://matrix.to/#/#hexops:matrix.org">Matrix chat room</a> to discuss ideas - collaboration very welcome!</p>

<p>Thanks for coming along in our journey!</p>

  </div>

  

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      <a alt="Twitter" href="https://twitter.com/slimsag""><img src="https://shields.io/badge/Twitter-follow-blue?logo=Twitter" class="color"></a>
&nbsp;
<a alt="RSS Follow" href="/feed.xml""><img src="https://shields.io/badge/RSS-follow-green?logo=RSS" class="color"></a>
&nbsp;
<a alt="License: CC BY 4.0" href="https://creativecommons.org/licenses/by/4.0"><img src="https://img.shields.io/badge/License-CC%20BY%204.0-lightgrey.svg" class="color"></a>
&nbsp;
<a alt="Hexops on GitHub" href="https://github.com/hexops" class="github color" style="background-image: url(https://raw.githubusercontent.com/simple-icons/simple-icons/develop/icons/github.svg);line-height: 1;padding-left: 1.5rem;background-repeat: no-repeat;padding-top: .25rem;"> GitHub</a>
<br>
<br>
<a href="https://hexops.com"><img class="logo color" height="50px" alt="Hexops logo" src="https://raw.githubusercontent.com/hexops/media/main/logo.svg"></a>
<br>


&copy;  2021 Hexops
<link rel="me" href="mailto:support@hexops.com">
    </p>

  </div>

</footer>


  </body>

</html>
